function y=FUZZY_MODEL(t,x)

load matrizes_fuzzy A B z11 z10 z21 z20 z31 z30 z41 z40
load gamma.mat

yaw=x(8);
u=zeros(4,1);
%u = [1; 0; 1; 0];

M10=(z11-(g2*cos(yaw)^2+g4*sin(yaw)^2))/(z11-z10);
M11=1-M10;
M20=(z21-((g2-g4)*sin(2*yaw)/2))/(z21-z20);
M21=1-M20;
M30=(z31-(cos(yaw)))/(z31-z30);
M31=1-M30;
M40=(z41-(sin(yaw)))/(z41-z40);
M41=1-M40;


h1=M11*M21*M31*M41;
h2=M11*M21*M31*M40;
h3=M11*M21*M30*M41;
h4=M11*M21*M30*M40;
h5=M11*M20*M31*M41;
h6=M11*M20*M31*M40;
h7=M11*M20*M30*M41;
h8=M11*M20*M30*M40;
h9=M10*M21*M31*M41;
h10=M10*M21*M31*M40;
h11=M10*M21*M30*M41;
h12=M10*M21*M30*M40;
h13=M10*M20*M31*M41;
h14=M10*M20*M31*M40;
h15=M10*M20*M30*M41;
h16=M10*M20*M30*M40;

% if (h1+h2+h3+h4+h5+h6+h7+h8+h9+h10+h11+h12+h13+h14+h15+h16 ~= 1)
%     disp('Diferente de 1')
% end

Ah=h1*A{1,1}+h2*A{1,2}+h3*A{1,3}+h4*A{1,4}+...
       h5*A{1,5}+h6*A{1,6}+h7*A{1,7}+h8*A{1,8}+...
       h9*A{1,9}+h10*A{1,10}+h11*A{1,11}+h12*A{1,12}+...
       h13*A{1,13}+h14*A{1,14}+h15*A{1,15}+h16*A{1,16};

 Bh=h1*B{1,1}+h2*B{1,2}+h3*B{1,3}+h4*B{1,4}+...
       h5*B{1,5}+h6*B{1,6}+h7*B{1,7}+h8*B{1,8}+...
       h9*B{1,9}+h10*B{1,10}+h11*B{1,11}+h12*B{1,12}+...
       h13*B{1,13}+h14*B{1,14}+h15*B{1,15}+h16*B{1,16};
   
y=Ah*x+Bh*u;

end